{% extends "base.html" %}
{% block title %}Price Tracker â€¢ Daraz Agentic AI{% endblock %}
{% block content %}
  <div class="grid">
    <div class="card" style="grid-column: span 12;">
      <div style="display:flex; align-items:center; justify-content:space-between;">
        <h2>AI Summary</h2>
        <form method="post" action="{{ url_for('send_alerts') }}">
          <button class="btn" type="submit">Send Alerts</button>
        </form>
      </div>
      <div style="white-space: pre-wrap; color: #0f172a;">{{ summary }}</div>
    </div>

    <div class="card" style="grid-column: span 12;">
      <h2>Tracked Products</h2>
      {% if not products %}
        <p class="tag">No products available. Go back and scrape first.</p>
      {% else %}
        <table class="table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Current Price</th>
              <th>Threshold</th>
              <th>Status</th>
              <th>Link</th>
            </tr>
          </thead>
          <tbody>
            {% for p in products %}
              <tr>
                <td>{{ p.name }}</td>
                <td>{{ p.price }}</td>
                <td>{{ p.threshold }}</td>
                <td>
                  {% if p.below_threshold %}
                    <span class="tag warn">Below threshold</span>
                  {% else %}
                    <span class="tag ok">Above threshold</span>
                  {% endif %}
                </td>
                <td><a href="{{ p.url }}" target="_blank">View</a></td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </div>
  </div>
{% endblock %}


