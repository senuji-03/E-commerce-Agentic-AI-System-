{% extends "base.html" %}
{% block title %}Compare {{ 'Laptops' if category == 'laptops' else 'Phones' }} • Daraz Agentic AI{% endblock %}
{% block content %}
  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">{{ '💻 Laptop Comparison' if category == 'laptops' else '📱 Phone Comparison' }}</h1>
      <p class="hero-subtitle">Select phones from multiple Sri Lankan retailers and compare the features you care about</p>
    </div>
  </div>

  <div class="grid">
    <div class="card" style="grid-column: span 12;">
      <div class="card-header">
        <h2>🔎 Select {{ 'Laptops' if category == 'laptops' else 'Phones' }} to Compare</h2>
        <div class="card-subtitle">Choose up to 5 {{ 'laptops' if category == 'laptops' else 'phones' }} and set your prioritized features (comma-separated)</div>
      </div>
      <form method="post" action="{{ url_for('compare', category=category) }}" class="scraping-form">
        <div class="grid">
          <div style="grid-column: span 8;">
            <div class="form-group">
              <label class="form-label"><span class="label-icon">🛍️</span>{{ 'Laptops' if category == 'laptops' else 'Phones' }}</label>
              <div style="display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:8px; max-height:280px; overflow:auto; border:1px solid #e2e8f0; border-radius:10px; padding:10px;">
                {% for p in products %}
                  <label style="display:flex; gap:10px; align-items:flex-start;">
                    <input type="checkbox" name="selected" value="{{ p.url }}" />
                    <div>
                      <div style="font-weight:700; color:#0f172a;">{{ p.name }}</div>
                      <div style="font-size:12px; color:#475569;">{{ p.price }} • {{ p.source or 'Daraz' }}</div>
                    </div>
                  </label>
                {% endfor %}
              </div>
            </div>
          </div>
          <div style="grid-column: span 4;">
            <div class="form-group">
              <label class="form-label"><span class="label-icon">✨</span>Prioritized features</label>
              <input class="input" type="text" name="priorities" value="{{ priorities }}" placeholder="e.g., price, battery, camera" />
            </div>
            <div class="form-group" style="display:flex; align-items:end;">
              <input type="hidden" name="category" value="{{ category or 'phones' }}" />
              <button class="btn scrape-btn" type="submit"><span class="btn-icon">🚀</span>Compare</button>
            </div>
          </div>
        </div>
      </form>
    </div>

    {% if comparison and (comparison.features or comparison.summary or comparison.highlights) %}
      {% if comparison.highlights %}
      <div class="card" style="grid-column: span 12;">
        <div class="card-header">
          <h3>🎯 Highlights</h3>
          <div class="card-subtitle">Based on your priorities</div>
        </div>
        <ul>
          {% for h in comparison.highlights %}
          <li>{{ h }}</li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}

      {% if comparison.features %}
      <div class="card" style="grid-column: span 12;">
        <div class="card-header">
          <h3>📊 Feature Comparison</h3>
        </div>
        <div style="overflow:auto;">
          <table class="table">
            <thead>
              <tr>
                <th>Feature</th>
                {% for r in selected %}
                  <th>{{ r.name }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in comparison.features %}
                <tr>
                  <td>{{ row['Feature'] }}</td>
                  {% for r in selected %}
                    <td>{{ row.get(r.name, '—') }}</td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      {% endif %}

      {% if comparison.summary %}
      <div class="card" style="grid-column: span 12; white-space: pre-wrap;">
        <h3>🤖 AI Summary</h3>
        <div style="color:#0f172a;">{{ comparison.summary }}</div>
      </div>
      {% endif %}

      {% if comparison.best %}
      <div class="card" style="grid-column: span 12;">
        <div class="card-header">
          <h3>🏆 Best Overall</h3>
          <div class="card-subtitle">Based on Gemini insights and your priorities</div>
        </div>
        <div style="font-weight:700; color:#0f172a;">{{ comparison.best }}</div>
        {% if comparison.best_reason %}
        <div style="margin-top:6px; color:#475569;">Why: {{ comparison.best_reason }}</div>
        {% endif %}
      </div>
      {% endif %}
    {% endif %}
  </div>
{% endblock %}


