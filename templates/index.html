{% extends "base.html" %}
{% block title %}Home • Daraz Agentic AI{% endblock %}
{% block content %}
  <div class="grid">
    <div class="card" style="grid-column: span 12;">
      <h2>Dashboard</h2>
      <div class="grid">
        <div class="card" style="grid-column: span 3;">
          <div class="tag">Total Products</div>
          <div style="font-size:28px; font-weight:800;">{{ total_products }}</div>
        </div>
        <div class="card" style="grid-column: span 3;">
          <div class="tag">Below Threshold</div>
          <div style="font-size:28px; font-weight:800;">{{ below_count }}</div>
        </div>
        <div class="card" style="grid-column: span 3;">
          <div class="tag">Last Brand</div>
          <div style="font-size:20px; font-weight:700;">{{ last_brand or '—' }}</div>
        </div>
        <div class="card" style="grid-column: span 3;">
          <div class="tag">Quick Links</div>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;">
            <a class="btn secondary" href="{{ url_for('tracker') }}">Price Tracker</a>
            <a class="btn secondary" href="{{ url_for('recommendations') }}">Recommendations</a>
          </div>
        </div>
      </div>
    </div>

    <div class="card" style="grid-column: span 8;">
      <h2>Brand Selection & Scraping</h2>
      <form method="post" action="{{ url_for('scrape') }}" class="grid">
        <div style="grid-column: span 4;">
          <label>Brand</label>
          <select class="input" name="brand">
            {% for b in brands %}
              <option value="{{ b }}">{{ b }}</option>
            {% endfor %}
          </select>
        </div>
        <div style="grid-column: span 4;">
          <label>Threshold</label>
          <input class="input" type="text" name="threshold" placeholder="Rs. 400000" />
        </div>
        <div style="grid-column: span 4; display:flex; align-items:end; gap:10px;">
          <button class="btn" type="submit">Update Product Prices</button>
        </div>
      </form>
      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
        {% for b in brands %}
          <a class="tag" href="#" onclick="quickBrand('{{ b }}'); return false;">{{ b }}</a>
        {% endfor %}
      </div>
    </div>

    <div class="card" style="grid-column: span 4;">
      <h2>Products by Brand</h2>
      <canvas id="brandChart" height="160"></canvas>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    function quickBrand(b) {
      const sel = document.querySelector('select[name="brand"]');
      if (sel) sel.value = b;
    }
    (function renderBrandChart(){
      var ctx = document.getElementById('brandChart');
      if (!ctx) return;
      var data = {{ brand_counts | tojson }};
      var labels = Object.keys(data);
      var values = Object.values(data);
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: values,
            backgroundColor: ['#fb923c','#fbbf24','#34d399','#60a5fa','#a78bfa','#f472b6','#22d3ee','#4ade80']
          }]
        },
        options: { plugins: { legend: { position: 'bottom' } } }
      });
    })();
  </script>
{% endblock %}


